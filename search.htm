<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repair Shop Admin - Search & Filter</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1d1d1f;
            --secondary: #86868b;
            --accent: #0071e3;
            --accent-hover: #0077ed;
            --border: #d2d2d7;
            --bg: #fbfbfd;
            --card-bg: #ffffff;
            --success: #34c759;
            --warning: #ff9500;
            --error: #ff3b30;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 12px 40px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: var(--bg);
            color: var(--primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        /* Language Switcher */
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 4px;
            box-shadow: var(--shadow-sm);
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .lang-btn:hover {
            color: var(--primary);
            background: var(--bg);
        }

        .lang-btn.active {
            background: var(--accent);
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        h1 {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 12px;
        }

        .subtitle {
            font-size: 21px;
            color: var(--secondary);
            font-weight: 400;
        }

        /* Search Section */
        .search-section {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-md);
            margin-bottom: 32px;
        }

        .search-box-container {
            position: relative;
            margin-bottom: 24px;
        }

        .search-box {
            width: 100%;
            padding: 18px 56px 18px 56px;
            border: 2px solid var(--border);
            border-radius: 50px;
            font-size: 17px;
            font-family: inherit;
            background: var(--bg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--primary);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
            background: white;
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: var(--secondary);
            pointer-events: none;
        }

        .clear-btn {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            border: none;
            background: var(--border);
            border-radius: 50%;
            color: var(--primary);
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-btn.visible {
            opacity: 1;
        }

        .clear-btn:hover {
            background: var(--secondary);
            color: white;
        }

        /* Advanced Filters */
        .advanced-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .filter-group {
            position: relative;
        }

        .filter-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            width: 100%;
            padding: 12px 40px 12px 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            background: white;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
            appearance: none;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
        }

        .filter-select:disabled {
            background: var(--bg);
            color: var(--secondary);
            cursor: not-allowed;
        }

        .select-arrow {
            position: absolute;
            right: 14px;
            bottom: 14px;
            font-size: 12px;
            color: var(--secondary);
            pointer-events: none;
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
            min-height: 32px;
        }

        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--accent);
            color: white;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .filter-tag-remove {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
            line-height: 1;
            transition: transform 0.2s;
        }

        .filter-tag-remove:hover {
            transform: scale(1.2);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .search-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 28px;
            border-radius: 980px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--accent-hover);
            transform: scale(1.02);
        }

        .btn-primary:disabled {
            background: var(--border);
            cursor: not-allowed;
            transform: scale(1);
        }

        .btn-secondary {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg);
            border-color: var(--accent);
        }

        /* Results Section */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-info {
            font-size: 15px;
            color: var(--secondary);
        }

        .results-count {
            font-weight: 600;
            color: var(--primary);
        }

        .sort-select {
            padding: 8px 36px 8px 12px;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 14px;
            font-family: inherit;
            background: white;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2386868b' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .sort-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* Results Grid */
        .results-grid {
            display: grid;
            gap: 16px;
        }

        .result-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 113, 227, 0.05), transparent);
            opacity: 0;
            transition: opacity 0.3s;
            border-radius: 18px;
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent);
        }

        .result-card:hover::before {
            opacity: 1;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .result-id {
            font-size: 12px;
            font-weight: 600;
            color: var(--secondary);
            font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
            background: var(--bg);
            padding: 4px 10px;
            border-radius: 6px;
        }

        .result-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 149, 0, 0.15);
            color: #c27400;
        }

        .status-in-progress {
            background: rgba(0, 113, 227, 0.15);
            color: #0056b3;
        }

        .status-completed {
            background: rgba(52, 199, 89, 0.15);
            color: #248a3d;
        }

        .status-cancelled {
            background: rgba(255, 59, 48, 0.15);
            color: #d70015;
        }

        .result-customer {
            font-size: 19px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .detail-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 14px;
            color: var(--primary);
            font-weight: 500;
        }

        .result-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .result-date {
            font-size: 13px;
            color: var(--secondary);
        }

        .view-details-btn {
            padding: 6px 16px;
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-details-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .empty-text {
            font-size: 15px;
            color: var(--secondary);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto 16px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 15px;
            color: var(--secondary);
        }

        /* Error State */
        .error-message {
            background: linear-gradient(135deg, rgba(255, 59, 48, 0.1), rgba(255, 59, 48, 0.05));
            border: 1px solid rgba(255, 59, 48, 0.3);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .error-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .error-content {
            flex: 1;
        }

        .error-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--error);
            margin-bottom: 4px;
        }

        .error-text {
            font-size: 14px;
            color: #d70015;
        }

        .error-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--error);
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        /* Detail Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card-bg);
            border-radius: 24px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg);
            border-radius: 50%;
            color: var(--primary);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--border);
        }

        .modal-body {
            padding: 32px;
            overflow-y: auto;
            max-height: calc(90vh - 100px);
        }

        .detail-section {
            margin-bottom: 32px;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .repairs-list {
            list-style: none;
        }

        .repair-item {
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .repair-name {
            font-weight: 500;
        }

        .repair-price {
            font-weight: 600;
            color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }

            .subtitle {
                font-size: 17px;
            }

            .search-section {
                padding: 20px;
            }

            .advanced-filters {
                grid-template-columns: 1fr;
            }

            .result-details {
                grid-template-columns: 1fr;
            }

            .modal {
                width: 95%;
            }

            .modal-header,
            .modal-body {
                padding: 20px;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Language Switcher -->
    <div class="language-switcher">
        <button class="lang-btn active" data-lang="en">English</button>
        <button class="lang-btn" data-lang="de">Deutsch</button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 id="pageTitle">Search Repair Requests</h1>
            <p class="subtitle" id="pageSubtitle">Find and manage repair requests with advanced filtering</p>
        </div>

        <!-- Error Message -->
        <div id="errorContainer"></div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-box-container">
                <span class="search-icon">üîç</span>
                <input 
                    type="text" 
                    class="search-box" 
                    id="searchInput" 
                    placeholder="Search by customer name, email, phone, address..."
                />
                <button class="clear-btn" id="clearBtn">√ó</button>
            </div>

            <div class="advanced-filters">
                <div class="filter-group">
                    <label class="filter-label" id="labelDeviceType">Device Type</label>
                    <select class="filter-select" id="deviceTypeFilter">
                        <option value="">All Types</option>
                    </select>
                    <span class="select-arrow">‚ñº</span>
                </div>

                <div class="filter-group">
                    <label class="filter-label" id="labelBrand">Brand</label>
                    <select class="filter-select" id="brandFilter">
                        <option value="">All Brands</option>
                    </select>
                    <span class="select-arrow">‚ñº</span>
                </div>

                <div class="filter-group">
                    <label class="filter-label" id="labelModel">Model</label>
                    <select class="filter-select" id="modelFilter" disabled>
                        <option value="">All Models</option>
                    </select>
                    <span class="select-arrow">‚ñº</span>
                </div>

                <div class="filter-group">
                    <label class="filter-label" id="labelCity">City</label>
                    <select class="filter-select" id="cityFilter">
                        <option value="">All Cities</option>
                    </select>
                    <span class="select-arrow">‚ñº</span>
                </div>
            </div>

            <div class="active-filters" id="activeFilters"></div>

            <div class="search-actions">
                <button class="btn btn-secondary" id="resetBtn">Reset All</button>
                <button class="btn btn-primary" id="searchBtn">Search</button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection">
            <div class="results-header">
                <div class="results-info">
                    <span id="resultsText">No search performed yet</span>
                    <span class="results-count" id="resultsCount"></span>
                </div>
            </div>

            <div id="resultsContainer">
                <div class="empty-state">
                    <div class="empty-icon">üìã</div>
                    <div class="empty-title" id="emptyTitle">Ready to Search</div>
                    <div class="empty-text" id="emptyText">Enter a search term or apply filters to find repair requests</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Request Details</div>
                <button class="modal-close" id="modalClose">√ó</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                pageTitle: 'Search Repair Requests',
                pageSubtitle: 'Find and manage repair requests with advanced filtering',
                searchPlaceholder: 'Search by customer name, email, phone, address...',
                labelDeviceType: 'Device Type',
                labelBrand: 'Brand',
                labelModel: 'Model',
                labelCity: 'City',
                optionAll: 'All',
                optionAllTypes: 'All Types',
                optionAllBrands: 'All Brands',
                optionAllModels: 'All Models',
                optionAllCities: 'All Cities',
                btnReset: 'Reset All',
                btnSearch: 'Search',
                resultsNoSearch: 'No search performed yet',
                resultsShowing: 'Showing',
                resultsOf: 'of',
                resultsTotal: 'total results',
                resultsFound: 'results found',
                emptyTitle: 'Ready to Search',
                emptyText: 'Enter a search term or apply filters to find repair requests',
                emptyNoResults: 'No Results Found',
                emptyNoResultsText: 'Try adjusting your search terms or filters',
                loading: 'Searching...',
                errorTitle: 'Error',
                errorLoadingFilters: 'Could not load filter options. Please try again.',
                errorSearching: 'An error occurred while searching. Please try again.',
                errorLoadingDetails: 'Could not load request details. Please try again.',
                modalTitle: 'Request Details',
                sectionCustomer: 'Customer Information',
                sectionDevice: 'Device Information',
                sectionRepairs: 'Repairs',
                sectionAppointment: 'Appointment',
                sectionNotes: 'Additional Notes',
                labelRequestId: 'Request ID',
                labelStatus: 'Status',
                labelSubmitted: 'Submitted',
                labelName: 'Name',
                labelEmail: 'Email',
                labelPhone: 'Phone',
                labelAddress: 'Address',
                labelDeviceType: 'Device Type',
                labelBrand: 'Brand',
                labelModel: 'Model',
                labelIMEI: 'IMEI',
                labelServiceType: 'Service Type',
                labelDate: 'Date',
                labelTime: 'Time Slot',
                labelNoAppointment: 'No appointment scheduled',
                labelNoNotes: 'No additional notes',
                btnViewDetails: 'View Details',
                statusPending: 'Pending',
                statusInProgress: 'In Progress',
                statusCompleted: 'Completed',
                statusCancelled: 'Cancelled',
                serviceWalkIn: 'Walk-in',
                serviceSendIn: 'Send-in'
            },
            de: {
                pageTitle: 'Reparaturanfragen durchsuchen',
                pageSubtitle: 'Finden und verwalten Sie Reparaturanfragen mit erweiterten Filtern',
                searchPlaceholder: 'Suche nach Kundenname, E-Mail, Telefon, Adresse...',
                labelDeviceType: 'Ger√§tetyp',
                labelBrand: 'Marke',
                labelModel: 'Modell',
                labelCity: 'Stadt',
                optionAll: 'Alle',
                optionAllTypes: 'Alle Typen',
                optionAllBrands: 'Alle Marken',
                optionAllModels: 'Alle Modelle',
                optionAllCities: 'Alle St√§dte',
                btnReset: 'Alle zur√ºcksetzen',
                btnSearch: 'Suchen',
                resultsNoSearch: 'Noch keine Suche durchgef√ºhrt',
                resultsShowing: 'Zeige',
                resultsOf: 'von',
                resultsTotal: 'Ergebnissen insgesamt',
                resultsFound: 'Ergebnisse gefunden',
                emptyTitle: 'Bereit zum Suchen',
                emptyText: 'Geben Sie einen Suchbegriff ein oder wenden Sie Filter an, um Reparaturanfragen zu finden',
                emptyNoResults: 'Keine Ergebnisse gefunden',
                emptyNoResultsText: 'Versuchen Sie, Ihre Suchbegriffe oder Filter anzupassen',
                loading: 'Suche l√§uft...',
                errorTitle: 'Fehler',
                errorLoadingFilters: 'Filteroptionen konnten nicht geladen werden. Bitte versuchen Sie es erneut.',
                errorSearching: 'Bei der Suche ist ein Fehler aufgetreten. Bitte versuchen Sie es erneut.',
                errorLoadingDetails: 'Anfragedetails konnten nicht geladen werden. Bitte versuchen Sie es erneut.',
                modalTitle: 'Anfragedetails',
                sectionCustomer: 'Kundeninformationen',
                sectionDevice: 'Ger√§teinformationen',
                sectionRepairs: 'Reparaturen',
                sectionAppointment: 'Termin',
                sectionNotes: 'Zus√§tzliche Notizen',
                labelRequestId: 'Anfrage-ID',
                labelStatus: 'Status',
                labelSubmitted: 'Eingereicht',
                labelName: 'Name',
                labelEmail: 'E-Mail',
                labelPhone: 'Telefon',
                labelAddress: 'Adresse',
                labelDeviceType: 'Ger√§tetyp',
                labelBrand: 'Marke',
                labelModel: 'Modell',
                labelIMEI: 'IMEI',
                labelServiceType: 'Service-Typ',
                labelDate: 'Datum',
                labelTime: 'Zeitfenster',
                labelNoAppointment: 'Kein Termin geplant',
                labelNoNotes: 'Keine zus√§tzlichen Notizen',
                btnViewDetails: 'Details anzeigen',
                statusPending: 'Ausstehend',
                statusInProgress: 'In Bearbeitung',
                statusCompleted: 'Abgeschlossen',
                statusCancelled: 'Storniert',
                serviceWalkIn: 'Vor Ort',
                serviceSendIn: 'Einsendung'
            }
        };

        let currentLang = 'en';
        const t = (key) => translations[currentLang][key] || key;

        // State
        let filterOptions = {
            deviceTypes: [],
            brands: [],
            models: [],
            cities: []
        };

        let activeFilters = {
            search: '',
            deviceType: '',
            brand: '',
            model: '',
            city: ''
        };

        let searchResults = [];

        // API base URL
        const API_BASE = 'https://repair.f418.eu';

        // Initialize
        async function init() {
            setupEventListeners();
            await loadFilterOptions();
            updateTexts();
        }

        // Event Listeners
        function setupEventListeners() {
            // Language switcher
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentLang = btn.dataset.lang;
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updateTexts();
                });
            });

            // Search input
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                activeFilters.search = e.target.value.trim();
                document.getElementById('clearBtn').classList.toggle('visible', e.target.value.length > 0);
            });

            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // Clear button
            document.getElementById('clearBtn').addEventListener('click', () => {
                searchInput.value = '';
                activeFilters.search = '';
                document.getElementById('clearBtn').classList.remove('visible');
            });

            // Filter selects
            document.getElementById('deviceTypeFilter').addEventListener('change', (e) => {
                activeFilters.deviceType = e.target.value;
                updateActiveFilters();
                updateModelFilter();
            });

            document.getElementById('brandFilter').addEventListener('change', (e) => {
                activeFilters.brand = e.target.value;
                updateActiveFilters();
                updateModelFilter();
            });

            document.getElementById('modelFilter').addEventListener('change', (e) => {
                activeFilters.model = e.target.value;
                updateActiveFilters();
            });

            document.getElementById('cityFilter').addEventListener('change', (e) => {
                activeFilters.city = e.target.value;
                updateActiveFilters();
            });

            // Action buttons
            document.getElementById('resetBtn').addEventListener('click', resetFilters);
            document.getElementById('searchBtn').addEventListener('click', performSearch);

            // Modal
            document.getElementById('modalClose').addEventListener('click', closeModal);
            document.getElementById('detailModal').addEventListener('click', (e) => {
                if (e.target.id === 'detailModal') closeModal();
            });
        }

        // Load filter options from API
        async function loadFilterOptions() {
            try {
                // Load device types
                const deviceTypesRes = await fetch(`${API_BASE}/options?filter=device_types`);
                const deviceTypesData = await deviceTypesRes.json();
                if (deviceTypesData.success) {
                    filterOptions.deviceTypes = deviceTypesData.options;
                    populateSelect('deviceTypeFilter', deviceTypesData.options);
                }

                // Load brands
                const brandsRes = await fetch(`${API_BASE}/options?filter=brands`);
                const brandsData = await brandsRes.json();
                if (brandsData.success) {
                    filterOptions.brands = brandsData.options;
                    populateSelect('brandFilter', brandsData.options);
                }

                // Load cities
                const citiesRes = await fetch(`${API_BASE}/options?filter=cities`);
                const citiesData = await citiesRes.json();
                if (citiesData.success) {
                    filterOptions.cities = citiesData.options;
                    populateSelect('cityFilter', citiesData.options);
                }
            } catch (error) {
                showError(t('errorLoadingFilters'));
                console.error('Error loading filter options:', error);
            }
        }

        // Populate select dropdown
        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            const currentValue = select.value;
            
            // Keep first option (All...)
            while (select.options.length > 1) {
                select.remove(1);
            }

            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });

            // Restore previous value if still valid
            if (currentValue && options.includes(currentValue)) {
                select.value = currentValue;
            }
        }

        // Update model filter based on device type and brand
        async function updateModelFilter() {
            const modelFilter = document.getElementById('modelFilter');
            const deviceType = activeFilters.deviceType;
            const brand = activeFilters.brand;

            if (!deviceType && !brand) {
                modelFilter.disabled = true;
                modelFilter.innerHTML = `<option value="">${t('optionAllModels')}</option>`;
                return;
            }

            try {
                let url = `${API_BASE}/options?filter=models`;
                if (deviceType) url += `&device_type=${encodeURIComponent(deviceType)}`;
                if (brand) url += `&brand=${encodeURIComponent(brand)}`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.success && data.options.length > 0) {
                    modelFilter.disabled = false;
                    populateSelect('modelFilter', data.options);
                } else {
                    modelFilter.disabled = true;
                    modelFilter.innerHTML = `<option value="">${t('optionAllModels')}</option>`;
                }
            } catch (error) {
                console.error('Error loading models:', error);
                modelFilter.disabled = true;
            }
        }

        // Update active filters display
        function updateActiveFilters() {
            const container = document.getElementById('activeFilters');
            const filters = [];

            if (activeFilters.search) {
                filters.push({ key: 'search', label: `Search: "${activeFilters.search}"` });
            }
            if (activeFilters.deviceType) {
                filters.push({ key: 'deviceType', label: `Device: ${activeFilters.deviceType}` });
            }
            if (activeFilters.brand) {
                filters.push({ key: 'brand', label: `Brand: ${activeFilters.brand}` });
            }
            if (activeFilters.model) {
                filters.push({ key: 'model', label: `Model: ${activeFilters.model}` });
            }
            if (activeFilters.city) {
                filters.push({ key: 'city', label: `City: ${activeFilters.city}` });
            }

            container.innerHTML = filters.map(f => `
                <div class="filter-tag">
                    ${f.label}
                    <button class="filter-tag-remove" onclick="removeFilter('${f.key}')">√ó</button>
                </div>
            `).join('');
        }

        // Remove individual filter
        function removeFilter(key) {
            activeFilters[key] = '';
            
            if (key === 'search') {
                document.getElementById('searchInput').value = '';
                document.getElementById('clearBtn').classList.remove('visible');
            } else if (key === 'deviceType') {
                document.getElementById('deviceTypeFilter').value = '';
                updateModelFilter();
            } else if (key === 'brand') {
                document.getElementById('brandFilter').value = '';
                updateModelFilter();
            } else if (key === 'model') {
                document.getElementById('modelFilter').value = '';
            } else if (key === 'city') {
                document.getElementById('cityFilter').value = '';
            }

            updateActiveFilters();
        }

        // Reset all filters
        function resetFilters() {
            activeFilters = {
                search: '',
                deviceType: '',
                brand: '',
                model: '',
                city: ''
            };

            document.getElementById('searchInput').value = '';
            document.getElementById('clearBtn').classList.remove('visible');
            document.getElementById('deviceTypeFilter').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('modelFilter').value = '';
            document.getElementById('cityFilter').value = '';
            document.getElementById('modelFilter').disabled = true;

            updateActiveFilters();
            searchResults = [];
            renderResults();
        }

        // Perform search
        async function performSearch() {
            const resultsContainer = document.getElementById('resultsContainer');
            
            // Show loading
            resultsContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">${t('loading')}</div>
                </div>
            `;

            try {
                // Build query parameters
                const params = new URLSearchParams();
                
                if (activeFilters.search) {
                    params.append('customer_search', activeFilters.search);
                }
                if (activeFilters.deviceType) {
                    params.append('device_type', activeFilters.deviceType);
                }
                if (activeFilters.brand) {
                    params.append('brand', activeFilters.brand);
                }
                if (activeFilters.model) {
                    params.append('model', activeFilters.model);
                }
                if (activeFilters.city) {
                    params.append('postal_code', activeFilters.city); // Using city for postal_code filter
                }

                params.append('limit', '50');

                const response = await fetch(`${API_BASE}/requests?${params.toString()}`);
                const data = await response.json();

                if (data.success) {
                    searchResults = data.results;
                    renderResults();
                    updateResultsInfo(data.count, data.total_found);
                } else {
                    throw new Error(data.error || 'Search failed');
                }
            } catch (error) {
                showError(t('errorSearching'));
                console.error('Error searching:', error);
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <div class="empty-title">${t('errorTitle')}</div>
                        <div class="empty-text">${t('errorSearching')}</div>
                    </div>
                `;
            }
        }

        // Render search results
        function renderResults() {
            const container = document.getElementById('resultsContainer');

            if (searchResults.length === 0) {
                const hasActiveFilters = Object.values(activeFilters).some(v => v !== '');
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">${hasActiveFilters ? 'üîç' : 'üìã'}</div>
                        <div class="empty-title">${hasActiveFilters ? t('emptyNoResults') : t('emptyTitle')}</div>
                        <div class="empty-text">${hasActiveFilters ? t('emptyNoResultsText') : t('emptyText')}</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="results-grid">
                    ${searchResults.map(result => renderResultCard(result)).join('')}
                </div>
            `;
        }

        // Render individual result card
        function renderResultCard(result) {
            const customer = result.customer || {};
            const device = result.device || {};
            const status = result.status || 'pending';
            const customerName = `${customer.firstName || ''} ${customer.lastName || ''}`.trim() || 'N/A';
            const deviceInfo = `${device.manufacturer || ''} ${device.model || ''}`.trim() || device.type || 'N/A';
            const address = customer.address || {};
            const fullAddress = `${address.street || ''} ${address.houseNumber || ''}, ${address.postalCode || ''} ${address.city || ''}`.trim();
            const submittedDate = result.submittedAt ? new Date(result.submittedAt).toLocaleDateString(currentLang === 'de' ? 'de-DE' : 'en-US') : 'N/A';

            return `
                <div class="result-card" onclick="viewDetails('${result._id}')">
                    <div class="result-header">
                        <div class="result-id">#${result._id.slice(-8)}</div>
                        <div class="result-status status-${status}">${t('status' + status.charAt(0).toUpperCase() + status.slice(1).replace('-', ''))}</div>
                    </div>
                    <div class="result-customer">${customerName}</div>
                    <div class="result-details">
                        <div class="detail-item">
                            <div class="detail-label">${t('labelDevice')}</div>
                            <div class="detail-value">${deviceInfo}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelEmail')}</div>
                            <div class="detail-value">${customer.email || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelPhone')}</div>
                            <div class="detail-value">${customer.phoneNumber || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelAddress')}</div>
                            <div class="detail-value">${fullAddress || 'N/A'}</div>
                        </div>
                    </div>
                    <div class="result-footer">
                        <div class="result-date">${t('labelSubmitted')}: ${submittedDate}</div>
                        <button class="view-details-btn" onclick="event.stopPropagation(); viewDetails('${result._id}')">${t('btnViewDetails')}</button>
                    </div>
                </div>
            `;
        }

        // Update results info
        function updateResultsInfo(count, total) {
            const resultsText = document.getElementById('resultsText');
            const resultsCount = document.getElementById('resultsCount');

            if (count === 0) {
                resultsText.textContent = t('emptyNoResults');
                resultsCount.textContent = '';
            } else {
                resultsText.textContent = `${t('resultsShowing')} ${count} ${t('resultsOf')} ${total}`;
                resultsCount.textContent = t('resultsTotal');
            }
        }

        // View details
        async function viewDetails(requestId) {
            const modal = document.getElementById('detailModal');
            const modalBody = document.getElementById('modalBody');

            // Show modal with loading
            modalBody.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">${t('loading')}</div>
                </div>
            `;
            modal.classList.add('active');

            try {
                const response = await fetch(`${API_BASE}/request?id=${requestId}`);
                const data = await response.json();

                if (data.success) {
                    renderDetails(data.data);
                } else {
                    throw new Error(data.error || 'Failed to load details');
                }
            } catch (error) {
                showError(t('errorLoadingDetails'));
                console.error('Error loading details:', error);
                modalBody.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ö†Ô∏è</div>
                        <div class="empty-title">${t('errorTitle')}</div>
                        <div class="empty-text">${t('errorLoadingDetails')}</div>
                    </div>
                `;
            }
        }

        // Render details in modal
        function renderDetails(data) {
            const modalBody = document.getElementById('modalBody');
            const customer = data.customer || {};
            const device = data.device || {};
            const address = customer.address || {};
            const appointment = data.appointment || null;
            const repairs = data.repairs || [];

            const customerName = `${customer.firstName || ''} ${customer.lastName || ''}`.trim();
            const fullAddress = `${address.street || ''} ${address.houseNumber || ''}, ${address.postalCode || ''} ${address.city || ''}`.trim();
            const deviceInfo = `${device.manufacturer || ''} ${device.model || ''}`.trim() || device.type;
            const submittedDate = data.submittedAt ? new Date(data.submittedAt).toLocaleString(currentLang === 'de' ? 'de-DE' : 'en-US') : 'N/A';

            modalBody.innerHTML = `
                <div class="detail-section">
                    <div class="detail-row">
                        <span class="detail-label">${t('labelRequestId')}</span>
                        <span class="detail-value">${data._id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">${t('labelStatus')}</span>
                        <span class="detail-value">${t('status' + (data.status || 'pending').charAt(0).toUpperCase() + (data.status || 'pending').slice(1).replace('-', ''))}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">${t('labelSubmitted')}</span>
                        <span class="detail-value">${submittedDate}</span>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="section-title">${t('sectionCustomer')}</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">${t('labelName')}</div>
                            <div class="detail-value">${customerName}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelEmail')}</div>
                            <div class="detail-value">${customer.email || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelPhone')}</div>
                            <div class="detail-value">${customer.phoneNumber || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelAddress')}</div>
                            <div class="detail-value">${fullAddress || 'N/A'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <div class="section-title">${t('sectionDevice')}</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">${t('labelDeviceType')}</div>
                            <div class="detail-value">${device.type || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelBrand')}</div>
                            <div class="detail-value">${device.manufacturer || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelModel')}</div>
                            <div class="detail-value">${device.model || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">${t('labelIMEI')}</div>
                            <div class="detail-value">${device.imei || 'N/A'}</div>
                        </div>
                    </div>
                </div>

                ${repairs.length > 0 ? `
                    <div class="detail-section">
                        <div class="section-title">${t('sectionRepairs')}</div>
                        <ul class="repairs-list">
                            ${repairs.map(repair => `
                                <li class="repair-item">
                                    <span class="repair-name">${repair.serviceName || 'N/A'}</span>
                                    ${repair.quotedPrice ? `<span class="repair-price">‚Ç¨${repair.quotedPrice}</span>` : ''}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                ` : ''}

                ${appointment ? `
                    <div class="detail-section">
                        <div class="section-title">${t('sectionAppointment')}</div>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">${t('labelDate')}</div>
                                <div class="detail-value">${appointment.date || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">${t('labelTime')}</div>
                                <div class="detail-value">${appointment.timeSlot || appointment.time || 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="detail-section">
                        <div class="section-title">${t('sectionAppointment')}</div>
                        <div class="detail-value">${t('labelNoAppointment')}</div>
                    </div>
                `}

                ${data.additionalNotes ? `
                    <div class="detail-section">
                        <div class="section-title">${t('sectionNotes')}</div>
                        <div class="detail-value">${data.additionalNotes}</div>
                    </div>
                ` : ''}
            `;
        }

        // Close modal
        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        // Show error message
        function showError(message) {
            const container = document.getElementById('errorContainer');
            const errorId = 'error-' + Date.now();
            
            container.innerHTML += `
                <div class="error-message" id="${errorId}">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-content">
                        <div class="error-title">${t('errorTitle')}</div>
                        <div class="error-text">${message}</div>
                    </div>
                    <button class="error-close" onclick="document.getElementById('${errorId}').remove()">√ó</button>
                </div>
            `;

            // Auto-remove after 5 seconds
            setTimeout(() => {
                const errorEl = document.getElementById(errorId);
                if (errorEl) errorEl.remove();
            }, 5000);
        }

        // Update all text elements
        function updateTexts() {
            document.getElementById('pageTitle').textContent = t('pageTitle');
            document.getElementById('pageSubtitle').textContent = t('pageSubtitle');
            document.getElementById('searchInput').placeholder = t('searchPlaceholder');
            
            // Filter labels
            document.querySelectorAll('.filter-label')[0].textContent = t('labelDeviceType');
            document.querySelectorAll('.filter-label')[1].textContent = t('labelBrand');
            document.querySelectorAll('.filter-label')[2].textContent = t('labelModel');
            document.querySelectorAll('.filter-label')[3].textContent = t('labelCity');

            // Select first options
            document.querySelector('#deviceTypeFilter option').textContent = t('optionAllTypes');
            document.querySelector('#brandFilter option').textContent = t('optionAllBrands');
            document.querySelector('#modelFilter option').textContent = t('optionAllModels');
            document.querySelector('#cityFilter option').textContent = t('optionAllCities');

            // Buttons
            document.getElementById('resetBtn').textContent = t('btnReset');
            document.getElementById('searchBtn').textContent = t('btnSearch');
            document.getElementById('modalTitle').textContent = t('modalTitle');

            // Update results if rendered
            if (searchResults.length > 0) {
                renderResults();
            } else {
                const resultsText = document.getElementById('resultsText');
                if (resultsText.textContent !== t('loading')) {
                    resultsText.textContent = t('resultsNoSearch');
                }
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
