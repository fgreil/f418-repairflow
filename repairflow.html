<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Repair Service</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1d1d1f;
            --secondary: #86868b;
            --accent: #0071e3;
            --border: #d2d2d7;
            --bg: #fbfbfd;
            --card-bg: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: var(--bg);
            color: var(--primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Language Switcher */
        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 16px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .lang-btn:hover {
            color: var(--primary);
            background: var(--bg);
        }

        .lang-btn.active {
            background: var(--accent);
            color: white;
        }

        .container {
            max-width: 980px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Progress Steps */
        .progress-container {
            padding: 60px 0 40px;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 20px;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border);
            z-index: 0;
        }

        .progress-line-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--accent);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            flex: 1;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            color: var(--secondary);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 12px;
        }

        .step.active .step-circle {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-circle {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .step-label {
            font-size: 13px;
            color: var(--secondary);
            font-weight: 500;
            text-align: center;
            transition: color 0.3s;
        }

        .step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }

        /* Content Sections */
        .content-section {
            display: none;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 12px;
            text-align: center;
        }

        .subtitle {
            font-size: 21px;
            color: var(--secondary);
            text-align: center;
            margin-bottom: 50px;
            font-weight: 400;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 40px;
        }

        /* Unified Card Styles */
        .card, .date-card, .time-card, .service-option {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 32px 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 113, 227, 0.05), transparent);
            opacity: 0;
            transition: opacity 0.3s;
            border-radius: 18px;
        }

        .card:hover, .date-card:hover, .time-card:hover, .service-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
            border-color: var(--accent);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card.selected, .date-card.selected, .time-card.selected, .service-option.selected {
            border-color: var(--accent);
            border-width: 2px;
            background: linear-gradient(135deg, rgba(0, 113, 227, 0.05), transparent);
        }

        .card-icon {
            font-size: 48px;
            margin-bottom: 16px;
            filter: grayscale(100%);
            transition: filter 0.3s;
        }

        .card:hover .card-icon,
        .card.selected .card-icon {
            filter: grayscale(0%);
        }

        .card-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--primary);
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--secondary);
            font-weight: 400;
        }

        /* Small card variant for models */
        .card.small {
            padding: 20px 16px;
        }

        .card.small .card-title {
            font-size: 15px;
            margin-bottom: 0;
        }

        /* Form Inputs */
        input, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            background: var(--card-bg);
            transition: all 0.2s;
            color: var(--primary);
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .form-row .form-group {
            margin-bottom: 0;
        }

        .form-row .form-group.short {
            flex: 0 0 25%;
        }

        .form-row .form-group.long {
            flex: 1;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
        }

        /* Summary Card */
        .summary-card {
            background: linear-gradient(135deg, #f5f5f7 0%, #ffffff 100%);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 32px;
            margin-bottom: 40px;
        }

        .summary-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            font-size: 15px;
            color: var(--secondary);
            font-weight: 500;
        }

        .summary-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary);
        }

        /* Selected Repairs Display */
        .selected-repairs-display {
            background: linear-gradient(135deg, rgba(0, 113, 227, 0.08), rgba(0, 113, 227, 0.02));
            border: 1px solid rgba(0, 113, 227, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .selected-repairs-text {
            font-size: 15px;
            color: var(--primary);
            font-weight: 500;
            text-align: center;
        }

        .selected-repairs-text.empty {
            color: var(--secondary);
            font-style: italic;
        }

        .repair-tag {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            margin: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        /* Service Type Selector */
        .service-type-selector {
            display: flex;
            gap: 16px;
            margin-bottom: 40px;
        }

        .service-option {
            flex: 1;
            border-width: 2px;
        }

        .service-badge {
            display: inline-block;
            background: #34c759;
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .service-icon {
            font-size: 40px;
            margin-bottom: 16px;
        }

        .service-title {
            font-size: 19px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .service-description {
            font-size: 14px;
            color: var(--secondary);
            line-height: 1.4;
        }

        /* Date and Time Picker */
        .date-time-container {
            margin-bottom: 40px;
        }

        .date-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }

        .date-card {
            padding: 16px 12px;
            border-radius: 12px;
        }

        .date-day {
            font-size: 13px;
            color: var(--secondary);
            margin-bottom: 4px;
        }

        .date-number {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
        }

        .date-month {
            font-size: 12px;
            color: var(--secondary);
            margin-top: 4px;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
        }

        .time-card {
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            color: var(--primary);
        }

        .time-card.selected {
            background: var(--accent);
            color: white;
        }

        .time-card.unavailable {
            opacity: 0.4;
            cursor: not-allowed;
            pointer-events: none;
        }

        .section-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary);
        }

        /* Repair Categories */
        .repair-category {
            margin-bottom: 24px;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }

        .category-header:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .category-header.active {
            background: linear-gradient(135deg, rgba(0, 113, 227, 0.05), transparent);
            border-color: var(--accent);
        }

        .category-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--primary);
            flex: 1;
        }

        .category-count {
            font-size: 14px;
            color: var(--secondary);
            background: var(--bg);
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 500;
        }

        .category-header.active .category-count {
            background: rgba(0, 113, 227, 0.1);
            color: var(--accent);
        }

        .category-chevron {
            font-size: 20px;
            color: var(--secondary);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .category-header.active .category-chevron {
            transform: rotate(180deg);
            color: var(--accent);
        }

        .category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .category-content.expanded {
            max-height: 2000px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
            padding: 20px 0;
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 40px;
        }

        button {
            padding: 14px 32px;
            border-radius: 980px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #0077ed;
            transform: scale(1.02);
        }

        .btn-primary:disabled {
            background: var(--border);
            cursor: not-allowed;
            transform: scale(1);
        }

        .btn-secondary {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg);
            border-color: var(--accent);
        }

        /* Success Message */
        .success-message {
            text-align: center;
            padding: 60px 20px;
        }

        .success-icon {
            font-size: 80px;
            margin-bottom: 24px;
            animation: scaleIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        .success-title {
            font-size: 40px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .success-text {
            font-size: 19px;
            color: var(--secondary);
            margin-bottom: 40px;
        }

        /* Back navigation */
        .back-nav {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--accent);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 30px;
            padding: 8px 0;
            transition: gap 0.2s;
        }

        .back-nav:hover {
            gap: 12px;
        }

        /* Hidden utility */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }

            .subtitle {
                font-size: 17px;
            }

            .grid, .category-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }

            .card {
                padding: 24px 16px;
            }

            .card-icon {
                font-size: 36px;
            }

            .card-title {
                font-size: 15px;
            }

            .card-subtitle {
                font-size: 12px;
            }

            .progress-steps {
                padding: 0 10px;
            }

            .step-label {
                font-size: 11px;
            }

            .step-circle {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .summary-card {
                padding: 24px;
            }

            .form-row {
                flex-direction: column;
            }

            .form-row .form-group.short,
            .form-row .form-group.long {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Language Switcher -->
    <div class="language-switcher">
        <button class="lang-btn active" data-lang="en">English</button>
        <button class="lang-btn" data-lang="de">Deutsch</button>
    </div>

    <div class="container">
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-line">
                    <div class="progress-line-fill" id="progressFill"></div>
                </div>
                <div class="step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Select Device</div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Select Repair</div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Get Quote</div>
                </div>
                <div class="step hidden" data-step="4" id="step4indicator">
                    <div class="step-circle">4</div>
                    <div class="step-label">Book Appointment</div>
                </div>
            </div>
        </div>

        <!-- Step 1: Select Device -->
        <div id="step1" class="content-section active">
            <h1>Select your device</h1>
            <p class="subtitle">Choose the device you need repaired</p>

            <!-- Back navigation (hidden initially) -->
            <div class="back-nav hidden" id="backFromBrand">‚Üê Back to devices</div>
            <div class="back-nav hidden" id="backFromModel">‚Üê Back to brands</div>
            
            <!-- Device type selection -->
            <div class="grid" id="deviceGrid"></div>

            <!-- Brand selection (for smartphones) -->
            <div class="grid hidden" id="brandGrid"></div>

            <!-- Model selection (for smartphones) -->
            <div class="grid hidden" id="modelGrid"></div>

            <!-- Custom text input (for non-smartphones or custom entries) -->
            <div id="customTextInput" class="hidden">
                <div class="form-group">
                    <label for="customText"></label>
                    <input type="text" id="customText" placeholder="">
                </div>
            </div>

            <div class="button-group">
                <button class="btn-primary" id="nextToRepair" disabled>Continue</button>
            </div>
        </div>

        <!-- Step 2: Select Repair -->
        <div id="step2" class="content-section">
            <h1>What needs fixing?</h1>
            <p class="subtitle">Select one or more repair services you need</p>
            
            <div class="selected-repairs-display">
                <div class="selected-repairs-text empty" id="selectedRepairsText">No repairs selected yet</div>
            </div>

            <div id="repairCategories"></div>

            <div class="button-group">
                <button class="btn-secondary" id="backToDevice">Back</button>
                <button class="btn-primary" id="nextToQuote" disabled>Continue</button>
            </div>
        </div>

        <!-- Step 3: Get Quote -->
        <div id="step3" class="content-section">
            <h1>Get your quote</h1>
            <p class="subtitle">We'll contact you with a detailed estimate</p>
            
            <div class="summary-card">
                <div class="summary-title">Repair Summary</div>
                <div class="summary-item">
                    <span class="summary-label">Device</span>
                    <span class="summary-value" id="summaryDevice">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Model</span>
                    <span class="summary-value" id="summaryModel">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Repairs</span>
                    <span class="summary-value" id="summaryRepair">-</span>
                </div>
            </div>

            <!-- Service Type Selector -->
            <div class="service-type-selector">
                <div class="service-option" data-service="shop" id="shopOption">
                    <div class="service-badge">FREE</div>
                    <div class="service-icon">üè™</div>
                    <div class="service-title">Visit our shop</div>
                    <div class="service-description">Repaired while you wait</div>
                </div>
                <div class="service-option" data-service="post" id="postOption">
                    <div class="service-badge">FREE</div>
                    <div class="service-icon">üì¶</div>
                    <div class="service-title">Send device</div>
                    <div class="service-description">Repair within 24 hours</div>
                </div>
            </div>

            <form id="quoteForm">
                <div class="form-group">
                    <label for="firstName">First Name *</label>
                    <input type="text" id="firstName" required placeholder="Erika">
                </div>

                <div class="form-group">
                    <label for="lastName">Last Name *</label>
                    <input type="text" id="lastName" required placeholder="Mustermann">
                </div>

                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" required placeholder="erika.mustermann@example.com">
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" required placeholder="+49 69 8062 6190">
                </div>

                <div class="form-group">
                    <label for="street">Street Name *</label>
                    <input type="text" id="street" required placeholder="Bernhard-Nocht-Str.">
                </div>

                <div class="form-group">
                    <label for="houseNumber">House Number *</label>
                    <input type="text" id="houseNumber" required placeholder="76">
                </div>

                <div class="form-row">
                    <div class="form-group short">
                        <label for="postalCode">Postal Code *</label>
                        <input type="text" id="postalCode" required placeholder="20359" pattern="[0-9]{5}" maxlength="5">
                    </div>
                    <div class="form-group long">
                        <label for="city">City *</label>
                        <input type="text" id="city" required placeholder="Hamburg">
                    </div>
                </div>

                <div class="form-group">
                    <label for="imei">IMEI Number (Optional)</label>
                    <input type="text" id="imei" placeholder="123456789012345" pattern="[0-9]{15}" maxlength="15">
                </div>

                <div class="form-group">
                    <label for="notes">Additional Notes (Optional)</label>
                    <textarea id="notes" placeholder="Tell us more about the issue..."></textarea>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" id="backToRepair">Back</button>
                    <button type="button" class="btn-primary" id="continueFromQuote">Continue</button>
                </div>
            </form>
        </div>

        <!-- Step 4: Book Appointment (Conditional) -->
        <div id="step4" class="content-section">
            <h1>Book an appointment</h1>
            <p class="subtitle">Choose your preferred date and time</p>

            <div class="date-time-container">
                <div class="section-title">Select a date</div>
                <div class="date-grid" id="dateGrid"></div>

                <div class="section-title" style="margin-top: 32px;">Select a time slot</div>
                <div class="time-grid" id="timeGrid"></div>
            </div>

            <div class="button-group">
                <button type="button" class="btn-secondary" id="backToQuote">Back</button>
                <button type="button" class="btn-primary" id="submitAppointment" disabled>Confirm Appointment</button>
            </div>
        </div>

        <!-- Success Message -->
        <div id="success" class="content-section">
            <div class="success-message">
                <div class="success-icon">‚úì</div>
                <h2 class="success-title">Request Submitted!</h2>
                <p class="success-text">We'll contact you shortly with a detailed quote and next steps.</p>
                <button class="btn-primary" onclick="window.location.href='/'">Back to homepage</button>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                stepDevice: 'Select Device', stepRepair: 'Select Repair', stepQuote: 'Get Quote', stepAppointment: 'Book Appointment',
                titleDevice: 'Select your device', subtitleDevice: 'Choose the device you need repaired',
                titleBrand: 'Select brand', subtitleBrand: 'Choose your device brand',
                titleModel: 'Select model', subtitleModel: 'Choose your device model',
                deviceSmartphones: 'Smartphones', deviceSmartphonesDesc: 'Mobile phones',
                deviceLaptops: 'Laptops', deviceLaptopsDesc: 'Portable computers',
                deviceWearables: 'Wearables', deviceWearablesDesc: 'Smart watches',
                deviceOther: 'Other', deviceOtherDesc: 'Other devices',
                backToDevices: '‚Üê Back to devices', backToBrands: '‚Üê Back to brands',
                otherBrand: 'Other Brand', otherBrandDesc: 'Not in list',
                otherModel: 'Other Model', otherModelDesc: 'Not in list',
                labelCustomBrand: 'Enter brand name', placeholderCustomBrand: 'e.g., OnePlus, Xiaomi, etc.',
                labelCustomModel: 'Enter model name', placeholderCustomModel: 'e.g., Pro Max, Note 10, etc.',
                labelDeviceText: 'Please specify your device', placeholderDeviceText: 'e.g., MacBook Pro 2021, Apple Watch Series 8',
                titleRepair: 'What needs fixing?', subtitleRepair: 'Select one or more repair services you need',
                noRepairsSelected: 'No repairs selected yet',
                titleQuote: 'Get your quote', subtitleQuote: "We'll contact you with a detailed estimate",
                summaryTitle: 'Repair Summary', summaryDevice: 'Device', summaryModel: 'Model', summaryRepairs: 'Repairs',
                serviceShopTitle: 'Visit our shop', serviceShopDesc: 'Repaired while you wait',
                servicePostTitle: 'Send device', servicePostDesc: 'Repair within 24 hours', serviceBadge: 'FREE',
                titleAppointment: 'Book an appointment', subtitleAppointment: 'Choose your preferred date and time',
                labelSelectDate: 'Select a date', labelSelectTime: 'Select a time slot',
                dayMon: 'Mon', dayTue: 'Tue', dayWed: 'Wed', dayThu: 'Thu', dayFri: 'Fri', daySat: 'Sat', daySun: 'Sun',
                monthJan: 'Jan', monthFeb: 'Feb', monthMar: 'Mar', monthApr: 'Apr', monthMay: 'May', monthJun: 'Jun',
                monthJul: 'Jul', monthAug: 'Aug', monthSep: 'Sep', monthOct: 'Oct', monthNov: 'Nov', monthDec: 'Dec',
                labelFirstName: 'First Name', labelLastName: 'Last Name', labelEmail: 'Email Address',
                labelPhone: 'Phone Number', labelStreet: 'Street Name', labelHouseNumber: 'House Number',
                labelPostalCode: 'Postal Code', labelCity: 'City', labelImei: 'IMEI Number (Optional)',
                labelNotes: 'Additional Notes (Optional)',
                placeholderFirstName: 'Erika', placeholderLastName: 'Mustermann',
                placeholderEmail: 'erika.mustermann@example.com', placeholderPhone: '+49 69 8062 6190',
                placeholderStreet: 'Bernhard-Nocht-Str.', placeholderHouseNumber: '76',
                placeholderPostalCode: '20359', placeholderCity: 'Hamburg',
                placeholderImei: '123456789012345', placeholderNotes: 'Tell us more about the issue...',
                btnContinue: 'Continue', btnBack: 'Back', btnSubmit: 'Submit Request',
                btnConfirmAppointment: 'Confirm Appointment', btnBackHome: 'Back to homepage',
                successTitle: 'Request Submitted!', successText: "We'll contact you shortly with a detailed quote and next steps.",
                repairScreen: 'Screen Repair', repairBattery: 'Battery Replacement', repairWater: 'Water Damage',
                repairCamera: 'Camera Repair', repairCharging: 'Charging Port', repairSpeaker: 'Speaker Repair',
                repairButton: 'Button Repair', repairBackGlass: 'Back Glass', repairSoftware: 'Software Issue',
                repairData: 'Data Recovery', repairMicrophone: 'Microphone', repairFaceID: 'Face ID Repair',
                repairMotherboard: 'Motherboard', repairAntenna: 'Antenna Repair', repairVibration: 'Vibration Motor',
                repairHome: 'Home Button', repairSIM: 'SIM Card Tray', repairWiFi: 'WiFi/Bluetooth',
                repairTouchID: 'Touch ID', repairCheckup: 'General Checkup',
                categoryDisplay: 'Display & Touch', categoryAccident: 'Accident & Physical Damage',
                categoryPower: 'Power & Charging', categoryAudio: 'Audio & Connectivity',
                categoryAdvanced: 'Advanced & Internal'
            },
            de: {
                stepDevice: 'Ger√§t w√§hlen', stepRepair: 'Reparatur w√§hlen', stepQuote: 'Angebot erhalten', stepAppointment: 'Termin buchen',
                titleDevice: 'W√§hlen Sie Ihr Ger√§t', subtitleDevice: 'W√§hlen Sie das zu reparierende Ger√§t',
                titleBrand: 'Marke w√§hlen', subtitleBrand: 'W√§hlen Sie Ihre Ger√§temarke',
                titleModel: 'Modell w√§hlen', subtitleModel: 'W√§hlen Sie Ihr Ger√§temodell',
                deviceSmartphones: 'Smartphones', deviceSmartphonesDesc: 'Mobiltelefone',
                deviceLaptops: 'Laptops', deviceLaptopsDesc: 'Tragbare Computer',
                deviceWearables: 'Wearables', deviceWearablesDesc: 'Smartwatches',
                deviceOther: 'Andere', deviceOtherDesc: 'Andere Ger√§te',
                backToDevices: '‚Üê Zur√ºck zu Ger√§ten', backToBrands: '‚Üê Zur√ºck zu Marken',
                otherBrand: 'Andere Marke', otherBrandDesc: 'Nicht in Liste',
                otherModel: 'Anderes Modell', otherModelDesc: 'Nicht in Liste',
                labelCustomBrand: 'Markennamen eingeben', placeholderCustomBrand: 'z.B. OnePlus, Xiaomi, usw.',
                labelCustomModel: 'Modellnamen eingeben', placeholderCustomModel: 'z.B. Pro Max, Note 10, usw.',
                labelDeviceText: 'Bitte geben Sie Ihr Ger√§t an', placeholderDeviceText: 'z.B. MacBook Pro 2021, Apple Watch Series 8',
                titleRepair: 'Was muss repariert werden?', subtitleRepair: 'W√§hlen Sie einen oder mehrere Reparaturdienste',
                noRepairsSelected: 'Noch keine Reparaturen ausgew√§hlt',
                titleQuote: 'Ihr Angebot erhalten', subtitleQuote: 'Wir kontaktieren Sie mit einem detaillierten Kostenvoranschlag',
                summaryTitle: 'Reparatur√ºbersicht', summaryDevice: 'Ger√§t', summaryModel: 'Modell', summaryRepairs: 'Reparaturen',
                serviceShopTitle: 'Besuchen Sie unser Gesch√§ft', serviceShopDesc: 'Erledigt, w√§hrend Sie warten',
                servicePostTitle: 'Ger√§t versenden', servicePostDesc: 'Reparatur binnen 24 Stunden', serviceBadge: 'GRATIS',
                titleAppointment: 'Termin buchen', subtitleAppointment: 'W√§hlen Sie Ihr bevorzugtes Datum und Ihre Uhrzeit',
                labelSelectDate: 'W√§hlen Sie ein Datum', labelSelectTime: 'W√§hlen Sie einen Zeitslot',
                dayMon: 'Mo', dayTue: 'Di', dayWed: 'Mi', dayThu: 'Do', dayFri: 'Fr', daySat: 'Sa', daySun: 'So',
                monthJan: 'Jan', monthFeb: 'Feb', monthMar: 'M√§r', monthApr: 'Apr', monthMay: 'Mai', monthJun: 'Jun',
                monthJul: 'Jul', monthAug: 'Aug', monthSep: 'Sep', monthOct: 'Okt', monthNov: 'Nov', monthDec: 'Dez',
                labelFirstName: 'Vorname', labelLastName: 'Nachname', labelEmail: 'E-Mail-Adresse',
                labelPhone: 'Telefonnummer', labelStreet: 'Stra√üe', labelHouseNumber: 'Hausnummer',
                labelPostalCode: 'Postleitzahl', labelCity: 'Stadt', labelImei: 'IMEI-Nummer (Optional)',
                labelNotes: 'Zus√§tzliche Anmerkungen (Optional)',
                placeholderFirstName: 'Max', placeholderLastName: 'Mustermann',
                placeholderEmail: 'max@beispiel.de', placeholderPhone: '+49 123 4567890',
                placeholderStreet: 'Bernhard-Nocht-Str.', placeholderHouseNumber: '76',
                placeholderPostalCode: '20359', placeholderCity: 'Hamburg',
                placeholderImei: '123456789012345', placeholderNotes: 'Erz√§hlen Sie uns mehr √ºber das Problem...',
                btnContinue: 'Weiter', btnBack: 'Zur√ºck', btnSubmit: 'Anfrage senden',
                btnConfirmAppointment: 'Termin best√§tigen', btnBackHome: 'Zur√ºck zur Startseite',
                successTitle: 'Anfrage gesendet!', successText: 'Wir kontaktieren Sie in K√ºrze mit einem detaillierten Angebot und den n√§chsten Schritten.',
                repairScreen: 'Display-Reparatur', repairBattery: 'Akku-Austausch', repairWater: 'Wasserschaden',
                repairCamera: 'Kamera-Reparatur', repairCharging: 'Ladebuchse', repairSpeaker: 'Lautsprecher-Reparatur',
                repairButton: 'Tasten-Reparatur', repairBackGlass: 'R√ºckseiten-Glas', repairSoftware: 'Software-Problem',
                repairData: 'Datenwiederherstellung', repairMicrophone: 'Mikrofon', repairFaceID: 'Face ID Reparatur',
                repairMotherboard: 'Hauptplatine', repairAntenna: 'Antennen-Reparatur', repairVibration: 'Vibrationsmotor',
                repairHome: 'Home-Taste', repairSIM: 'SIM-Kartenfach', repairWiFi: 'WLAN/Bluetooth',
                repairTouchID: 'Touch ID', repairCheckup: 'Allgemeine √úberpr√ºfung',
                categoryDisplay: 'Display & Touch', categoryAccident: 'Unfall & Physische Sch√§den',
                categoryPower: 'Strom & Laden', categoryAudio: 'Audio & Konnektivit√§t',
                categoryAdvanced: 'Erweitert & Intern'
            }
        };

        let currentLang = 'en';
        const t = (key) => translations[currentLang][key] || key;

        // Data
        const devices = [
            { id: 'smartphones', nameKey: 'deviceSmartphones', descKey: 'deviceSmartphonesDesc', icon: 'üì±', hasModels: true },
            { id: 'laptops', nameKey: 'deviceLaptops', descKey: 'deviceLaptopsDesc', icon: 'üíª', hasModels: false },
            { id: 'wearables', nameKey: 'deviceWearables', descKey: 'deviceWearablesDesc', icon: '‚åö', hasModels: false },
            { id: 'other', nameKey: 'deviceOther', descKey: 'deviceOtherDesc', icon: 'üîß', hasModels: false }
        ];

        const brands = [
            { id: 'apple', name: 'Apple', icon: 'üçé' },
            { id: 'samsung', name: 'Samsung', icon: 'üì±' },
            { id: 'google', name: 'Google', icon: 'üîç' },
            { id: 'xiaomi', name: 'Xiaomi', icon: 'üì±' },
            { id: 'oneplus', name: 'OnePlus', icon: '1Ô∏è‚É£' },
            { id: 'oppo', name: 'Oppo', icon: 'üì±' },
            { id: 'vivo', name: 'Vivo', icon: 'üì±' },
            { id: 'motorola', name: 'Motorola', icon: 'üì±' },
            { id: 'sony', name: 'Sony', icon: 'üéÆ' },
            { id: 'realme', name: 'Realme', icon: 'üì±' },
            { id: 'nokia', name: 'Nokia', icon: 'üì±' },
            { id: 'asus', name: 'Asus', icon: 'üéÆ' },
            { id: 'nothing', name: 'Nothing', icon: '‚ö°' },
            { id: 'honor', name: 'Honor', icon: 'üì±' },
            { id: 'huawei', name: 'Huawei', icon: 'üì±' }
        ];

        const models = {
            apple: ['iPhone 15 Pro Max', 'iPhone 15 Pro', 'iPhone 15', 'iPhone 15 Plus', 'iPhone 14 Pro Max', 'iPhone 14 Pro', 'iPhone 14', 'iPhone 14 Plus', 'iPhone 13 Pro Max', 'iPhone 13 Pro', 'iPhone 13', 'iPhone SE (3rd gen)'],
            samsung: ['Galaxy S24 Ultra', 'Galaxy S24+', 'Galaxy S24', 'Galaxy S23 Ultra', 'Galaxy S23+', 'Galaxy S23', 'Galaxy S23 FE', 'Galaxy Z Fold5', 'Galaxy Z Flip5', 'Galaxy A54 5G', 'Galaxy A34 5G', 'Galaxy A14 5G'],
            google: ['Pixel 8 Pro', 'Pixel 8', 'Pixel 8a', 'Pixel 7a', 'Pixel 7 Pro', 'Pixel 7', 'Pixel 6a'],
            xiaomi: ['14 Ultra', '14 Pro', '14', '13T Pro', '13T', 'Redmi Note 13 Pro+', 'Redmi Note 13 Pro', 'Redmi Note 13', 'Redmi 13C', 'Poco X6 Pro', 'Poco F5'],
            oneplus: ['12', '12R', '11', 'Nord 3', 'Nord CE 3', 'Nord N30'],
            oppo: ['Find X6 Pro', 'Find X5 Pro', 'Reno 11 Pro', 'Reno 10 Pro+', 'A78 5G', 'A58'],
            vivo: ['X100 Pro', 'X90 Pro', 'V29 Pro', 'V27 Pro', 'Y36 5G', 'Y27'],
            motorola: ['Edge 40 Pro', 'Edge 40', 'Edge 30 Ultra', 'Moto G84', 'Moto G73'],
            sony: ['Xperia 1 V', 'Xperia 5 V', 'Xperia 10 V', 'Xperia 1 IV'],
            realme: ['GT 5 Pro', 'GT Neo 5', '11 Pro+', 'C55', 'Narzo 60 Pro'],
            nokia: ['XR21', 'G60 5G', 'X30 5G'],
            asus: ['ROG Phone 7', 'ROG Phone 6', 'Zenfone 10', 'Zenfone 9'],
            nothing: ['Phone (2)', 'Phone (2a)', 'Phone (1)'],
            honor: ['Magic 6 Pro', 'Magic 5 Pro', '90', 'X9a'],
            huawei: ['P60 Pro', 'Mate 60 Pro', 'Nova 11']
        };

        const repairs = [
            { id: 1, nameKey: 'repairScreen', icon: 'üîß', category: 'display' },
            { id: 19, nameKey: 'repairTouchID', icon: 'üëÜ', category: 'display' },
            { id: 12, nameKey: 'repairFaceID', icon: 'üë§', category: 'display' },
            { id: 3, nameKey: 'repairWater', icon: 'üíß', category: 'accident' },
            { id: 8, nameKey: 'repairBackGlass', icon: 'ü™ü', category: 'accident' },
            { id: 7, nameKey: 'repairButton', icon: 'üîò', category: 'accident' },
            { id: 16, nameKey: 'repairHome', icon: '‚è∫Ô∏è', category: 'accident' },
            { id: 2, nameKey: 'repairBattery', icon: 'üîã', category: 'power' },
            { id: 5, nameKey: 'repairCharging', icon: '‚ö°', category: 'power' },
            { id: 6, nameKey: 'repairSpeaker', icon: 'üîä', category: 'audio' },
            { id: 11, nameKey: 'repairMicrophone', icon: 'üé§', category: 'audio' },
            { id: 4, nameKey: 'repairCamera', icon: 'üì∑', category: 'audio' },
            { id: 18, nameKey: 'repairWiFi', icon: 'üì∂', category: 'audio' },
            { id: 14, nameKey: 'repairAntenna', icon: 'üì°', category: 'audio' },
            { id: 17, nameKey: 'repairSIM', icon: 'üìá', category: 'audio' },
            { id: 9, nameKey: 'repairSoftware', icon: 'üíæ', category: 'advanced' },
            { id: 10, nameKey: 'repairData', icon: 'üíø', category: 'advanced' },
            { id: 13, nameKey: 'repairMotherboard', icon: 'üñ•Ô∏è', category: 'advanced' },
            { id: 15, nameKey: 'repairVibration', icon: 'üì≥', category: 'advanced' },
            { id: 20, nameKey: 'repairCheckup', icon: 'üîç', category: 'advanced' }
        ];

        const repairCategories = [
            { id: 'display', nameKey: 'categoryDisplay' },
            { id: 'accident', nameKey: 'categoryAccident' },
            { id: 'power', nameKey: 'categoryPower' },
            { id: 'audio', nameKey: 'categoryAudio' },
            { id: 'advanced', nameKey: 'categoryAdvanced' }
        ];

        // State
        let state = {
            device: null,
            brand: null,
            model: null,
            customText: '',
            repairs: [],
            serviceType: null,
            date: null,
            time: null,
            view: 'device' // device, brand, model
        };

        // Initialize
        function init() {
            renderDevices();
            renderRepairs();
            setupEventListeners();
        }

        // Unified rendering
        function renderDevices() {
            const grid = document.getElementById('deviceGrid');
            grid.innerHTML = devices.map(d => `
                <div class="card" data-id="${d.id}">
                    <div class="card-icon">${d.icon}</div>
                    <div class="card-title">${t(d.nameKey)}</div>
                    <div class="card-subtitle">${t(d.descKey)}</div>
                </div>
            `).join('');

            grid.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => selectDevice(card.dataset.id));
            });
        }

        function renderBrands() {
            const grid = document.getElementById('brandGrid');
            const allBrands = [...brands, { id: 'other', nameKey: 'otherBrand', descKey: 'otherBrandDesc', icon: 'üì±' }];
            
            grid.innerHTML = allBrands.map(b => `
                <div class="card" data-id="${b.id}">
                    <div class="card-icon">${b.icon}</div>
                    <div class="card-title">${b.nameKey ? t(b.nameKey) : b.name}</div>
                    ${b.descKey ? `<div class="card-subtitle">${t(b.descKey)}</div>` : ''}
                </div>
            `).join('');

            grid.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => selectBrand(card.dataset.id));
            });
        }

        function renderModels(brandId) {
            const grid = document.getElementById('modelGrid');
            const brandModels = models[brandId] || [];
            const allModels = [...brandModels, 'other'];
            
            grid.innerHTML = allModels.map(m => {
                if (m === 'other') {
                    return `
                        <div class="card" data-id="other">
                            <div class="card-icon">üì±</div>
                            <div class="card-title">${t('otherModel')}</div>
                            <div class="card-subtitle">${t('otherModelDesc')}</div>
                        </div>
                    `;
                }
                return `
                    <div class="card small" data-id="${m}">
                        <div class="card-title">${m}</div>
                    </div>
                `;
            }).join('');

            grid.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', () => selectModel(card.dataset.id));
            });
        }

        function selectDevice(deviceId) {
            state.device = deviceId;
            state.brand = null;
            state.model = null;
            state.customText = '';

            const device = devices.find(d => d.id === deviceId);
            
            document.querySelectorAll('#deviceGrid .card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`#deviceGrid [data-id="${deviceId}"]`).classList.add('selected');

            if (device.hasModels) {
                state.view = 'brand';
                showView('brand');
                renderBrands();
            } else {
                showCustomInput('device');
            }

            updateContinueButton();
        }

        function selectBrand(brandId) {
            state.brand = brandId;
            state.model = null;

            if (brandId === 'other') {
                showCustomInput('brand');
            } else {
                state.view = 'model';
                showView('model');
                renderModels(brandId);
            }

            updateContinueButton();
        }

        function selectModel(modelId) {
            state.model = modelId;

            if (modelId === 'other') {
                showCustomInput('model');
            } else {
                document.querySelectorAll('#modelGrid .card').forEach(c => c.classList.remove('selected'));
                document.querySelector(`#modelGrid [data-id="${modelId}"]`).classList.add('selected');
            }

            updateContinueButton();
        }

        function showView(view) {
            // Hide all grids
            document.getElementById('deviceGrid').classList.add('hidden');
            document.getElementById('brandGrid').classList.add('hidden');
            document.getElementById('modelGrid').classList.add('hidden');
            document.getElementById('customTextInput').classList.add('hidden');
            document.getElementById('backFromBrand').classList.add('hidden');
            document.getElementById('backFromModel').classList.add('hidden');

            // Update title
            const titleMap = { device: 'titleDevice', brand: 'titleBrand', model: 'titleModel' };
            const subtitleMap = { device: 'subtitleDevice', brand: 'subtitleBrand', model: 'subtitleModel' };
            
            document.querySelector('#step1 h1').textContent = t(titleMap[view]);
            document.querySelector('#step1 .subtitle').textContent = t(subtitleMap[view]);

            // Show appropriate view
            if (view === 'device') {
                document.getElementById('deviceGrid').classList.remove('hidden');
            } else if (view === 'brand') {
                document.getElementById('brandGrid').classList.remove('hidden');
                document.getElementById('backFromBrand').classList.remove('hidden');
            } else if (view === 'model') {
                document.getElementById('modelGrid').classList.remove('hidden');
                document.getElementById('backFromModel').classList.remove('hidden');
            }
        }

        function showCustomInput(type) {
            const input = document.getElementById('customTextInput');
            const textField = document.getElementById('customText');
            const label = input.querySelector('label');

            input.classList.remove('hidden');
            document.getElementById('deviceGrid').classList.add('hidden');
            document.getElementById('brandGrid').classList.add('hidden');
            document.getElementById('modelGrid').classList.add('hidden');

            if (type === 'device') {
                label.textContent = t('labelDeviceText');
                textField.placeholder = t('placeholderDeviceText');
                document.getElementById('backFromBrand').classList.add('hidden');
                document.getElementById('backFromModel').classList.add('hidden');
            } else if (type === 'brand') {
                label.textContent = t('labelCustomBrand');
                textField.placeholder = t('placeholderCustomBrand');
                document.getElementById('backFromModel').classList.add('hidden');
            } else if (type === 'model') {
                label.textContent = t('labelCustomModel');
                textField.placeholder = t('placeholderCustomModel');
            }

            textField.value = '';
            textField.focus();
        }

        function renderRepairs() {
            const container = document.getElementById('repairCategories');
            
            container.innerHTML = repairCategories.map(cat => {
                const catRepairs = repairs.filter(r => r.category === cat.id);
                const selectedCount = catRepairs.filter(r => state.repairs.includes(String(r.id))).length;
                const countText = selectedCount > 0 ? `${selectedCount}/${catRepairs.length}` : `${catRepairs.length}`;
                
                return `
                    <div class="repair-category">
                        <div class="category-header" data-category="${cat.id}">
                            <div class="category-title">${t(cat.nameKey)}</div>
                            <div class="category-count">${countText}</div>
                            <div class="category-chevron">‚ñº</div>
                        </div>
                        <div class="category-content" data-category-content="${cat.id}">
                            <div class="category-grid">
                                ${catRepairs.map(r => `
                                    <div class="card ${state.repairs.includes(String(r.id)) ? 'selected' : ''}" data-repair="${r.id}">
                                        <div class="card-icon">${r.icon}</div>
                                        <div class="card-title">${t(r.nameKey)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.querySelectorAll('.category-header').forEach(h => {
                h.addEventListener('click', () => toggleCategory(h.dataset.category));
            });

            container.querySelectorAll('.card').forEach(c => {
                c.addEventListener('click', () => toggleRepair(c.dataset.repair));
            });
        }

        function toggleCategory(catId) {
            const header = document.querySelector(`[data-category="${catId}"]`);
            const content = document.querySelector(`[data-category-content="${catId}"]`);
            const isExpanded = content.classList.contains('expanded');

            if (isExpanded) {
                content.classList.remove('expanded');
                header.classList.remove('active');
            } else {
                content.classList.add('expanded');
                header.classList.add('active');
            }
        }

        function toggleRepair(repairId) {
            const idx = state.repairs.indexOf(repairId);
            if (idx > -1) {
                state.repairs.splice(idx, 1);
            } else {
                state.repairs.push(repairId);
            }

            renderRepairs();
            updateSelectedRepairsDisplay();
            document.getElementById('nextToQuote').disabled = state.repairs.length === 0;
        }

        function updateSelectedRepairsDisplay() {
            const display = document.getElementById('selectedRepairsText');
            
            if (state.repairs.length === 0) {
                display.innerHTML = t('noRepairsSelected');
                display.classList.add('empty');
            } else {
                display.innerHTML = state.repairs.map(id => {
                    const repair = repairs.find(r => r.id == id);
                    return `<span class="repair-tag">${repair.icon} ${t(repair.nameKey)}</span>`;
                }).join('');
                display.classList.remove('empty');
            }
        }

        function updateContinueButton() {
            const device = devices.find(d => d.id === state.device);
            let canContinue = false;

            if (!device) {
                canContinue = false;
            } else if (!device.hasModels) {
                canContinue = state.customText.trim().length > 0;
            } else {
                if (state.brand === 'other') {
                    canContinue = state.customText.trim().length > 0;
                } else if (state.model === 'other') {
                    canContinue = state.customText.trim().length > 0;
                } else {
                    canContinue = state.brand && state.model;
                }
            }

            document.getElementById('nextToRepair').disabled = !canContinue;
        }

        function updateProgress(step) {
            const steps = document.querySelectorAll('.step');
            const progressFill = document.getElementById('progressFill');
            const totalSteps = state.serviceType === 'shop' ? 4 : 3;

            steps.forEach(s => {
                const stepNum = parseInt(s.dataset.step);
                s.classList.remove('active', 'completed');
                if (stepNum < step) s.classList.add('completed');
                if (stepNum === step) s.classList.add('active');
            });

            const progress = ((step - 1) / (totalSteps - 1)) * 100;
            progressFill.style.width = `${progress}%`;
        }

        function goToStep(step) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            updateProgress(step);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateSummary() {
            const device = devices.find(d => d.id === state.device);
            document.getElementById('summaryDevice').textContent = t(device.nameKey);

            let modelText = '';
            if (!device.hasModels) {
                modelText = state.customText;
            } else {
                const brandName = state.brand === 'other' ? state.customText : brands.find(b => b.id === state.brand)?.name;
                const modelName = state.model === 'other' ? state.customText : state.model;
                modelText = `${brandName} - ${modelName}`;
            }
            document.getElementById('summaryModel').textContent = modelText;

            const repairList = state.repairs.map(id => t(repairs.find(r => r.id == id).nameKey)).join(', ');
            document.getElementById('summaryRepair').textContent = repairList;
        }

        function renderDatePicker() {
            const dates = [];
            const today = new Date();
            for (let i = 1; i <= 14; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                dates.push(date);
            }

            const dayNames = ['daySun', 'dayMon', 'dayTue', 'dayWed', 'dayThu', 'dayFri', 'daySat'];
            const monthNames = ['monthJan', 'monthFeb', 'monthMar', 'monthApr', 'monthMay', 'monthJun',
                               'monthJul', 'monthAug', 'monthSep', 'monthOct', 'monthNov', 'monthDec'];

            const grid = document.getElementById('dateGrid');
            grid.innerHTML = dates.map(date => {
                const dateStr = date.toISOString().split('T')[0];
                return `
                    <div class="date-card" data-date="${dateStr}">
                        <div class="date-day">${t(dayNames[date.getDay()])}</div>
                        <div class="date-number">${date.getDate()}</div>
                        <div class="date-month">${t(monthNames[date.getMonth()])}</div>
                    </div>
                `;
            }).join('');

            grid.querySelectorAll('.date-card').forEach(c => {
                c.addEventListener('click', () => selectDate(c.dataset.date));
            });
        }

        function selectDate(date) {
            state.date = date;
            state.time = null;

            document.querySelectorAll('.date-card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`[data-date="${date}"]`).classList.add('selected');

            renderTimePicker();
            document.getElementById('submitAppointment').disabled = true;
        }

        function renderTimePicker() {
            const times = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            const grid = document.getElementById('timeGrid');

            grid.innerHTML = times.map(time => {
                const isAvailable = Math.random() > 0.3;
                return `<div class="time-card ${!isAvailable ? 'unavailable' : ''}" data-time="${time}">${time}</div>`;
            }).join('');

            grid.querySelectorAll('.time-card:not(.unavailable)').forEach(c => {
                c.addEventListener('click', () => selectTime(c.dataset.time));
            });
        }

        function selectTime(time) {
            state.time = time;
            document.querySelectorAll('.time-card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`[data-time="${time}"]`).classList.add('selected');
            document.getElementById('submitAppointment').disabled = false;
        }

        function setupEventListeners() {
            // Language switcher
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentLang = btn.dataset.lang;
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    updateAllText();
                });
            });

            // Custom text input
            document.getElementById('customText').addEventListener('input', (e) => {
                state.customText = e.target.value.trim();
                updateContinueButton();
            });

            // Back navigation
            document.getElementById('backFromBrand').addEventListener('click', () => {
                state.view = 'device';
                state.brand = null;
                state.model = null;
                showView('device');
                updateContinueButton();
            });

            document.getElementById('backFromModel').addEventListener('click', () => {
                state.view = 'brand';
                state.model = null;
                showView('brand');
                updateContinueButton();
            });

            // Service type
            document.querySelectorAll('.service-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    state.serviceType = opt.dataset.service;
                    document.querySelectorAll('.service-option').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    
                    const step4 = document.getElementById('step4indicator');
                    step4.classList.toggle('hidden', state.serviceType !== 'shop');
                    
                    const btn = document.getElementById('continueFromQuote');
                    btn.textContent = state.serviceType === 'post' ? t('btnSubmit') : t('btnContinue');
                    btn.disabled = false;
                });
            });

            // Navigation buttons
            document.getElementById('nextToRepair').addEventListener('click', () => goToStep(2));
            document.getElementById('backToDevice').addEventListener('click', () => goToStep(1));
            document.getElementById('nextToQuote').addEventListener('click', () => {
                updateSummary();
                goToStep(3);
            });
            document.getElementById('backToRepair').addEventListener('click', () => goToStep(2));
            document.getElementById('continueFromQuote').addEventListener('click', () => {
                const form = document.getElementById('quoteForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                if (state.serviceType === 'shop') {
                    renderDatePicker();
                    goToStep(4);
                } else {
                    submitRequest();
                }
            });
            document.getElementById('backToQuote').addEventListener('click', () => goToStep(3));
            document.getElementById('submitAppointment').addEventListener('click', submitRequest);
        }

        async function submitRequest() {
            const submitBtn = state.serviceType === 'shop' 
                ? document.getElementById('submitAppointment')
                : document.getElementById('continueFromQuote');
            
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            try {
                const device = devices.find(d => d.id === state.device);
                let brandName, modelName;

                if (!device.hasModels) {
                    brandName = null;
                    modelName = state.customText;
                } else {
                    brandName = state.brand === 'other' ? state.customText : state.brand;
                    modelName = state.model === 'other' ? state.customText : state.model;
                }

                const requestData = {
                    customer: {
                        firstName: document.getElementById('firstName').value,
                        lastName: document.getElementById('lastName').value,
                        email: document.getElementById('email').value,
                        phoneNumber: document.getElementById('phone').value,
                        address: {
                            streetName: document.getElementById('street').value,
                            houseNumber: document.getElementById('houseNumber').value,
                            postalCode: document.getElementById('postalCode').value,
                            city: document.getElementById('city').value
                        }
                    },
                    device: {
                        type: device.nameKey,
                        brand: brandName,
                        model: modelName,
                        imei: document.getElementById('imei').value || undefined
                    },
                    repairs: state.repairs.map(id => ({
                        serviceName: repairs.find(r => r.id == id).nameKey,
                        quotedPrice: 0
                    })),
                    serviceType: state.serviceType === 'shop' ? 'walk-in' : 'send-in',
                    additionalNotes: document.getElementById('notes').value || undefined
                };

                if (state.serviceType === 'shop' && state.date && state.time) {
                    requestData.appointment = {
                        date: state.date,
                        time: state.time
                    };
                }

                const response = await fetch('https://repair.f418.eu/request', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    displaySuccess(result.id, result.submittedAt || new Date().toISOString());
                } else {
                    displayError(result.error || 'Submission failed');
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            } catch (error) {
                displayError(`Network error: ${error.message}`);
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        function displaySuccess(documentId, timestamp) {
            const successSection = document.getElementById('success');
            let infoDiv = successSection.querySelector('.server-info');
            
            if (!infoDiv) {
                infoDiv = document.createElement('div');
                infoDiv.className = 'server-info';
                infoDiv.style.cssText = 'margin: 30px 0; padding: 20px; background: var(--bg); border-radius: 12px; font-size: 15px;';
                const successText = successSection.querySelector('.success-text');
                successText.parentNode.insertBefore(infoDiv, successText.nextSibling);
            }

            const date = new Date(timestamp);
            infoDiv.innerHTML = `
                <p style="margin-bottom: 10px;"><strong>Request ID:</strong> <code style="background: white; padding: 4px 8px; border-radius: 6px; font-family: monospace;">${documentId}</code></p>
                <p><strong>Submitted at:</strong> ${date.toLocaleString()}</p>
            `;

            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            successSection.classList.add('active');
        }

        function displayError(errorMessage) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #ff3b30; color: white; padding: 16px 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 10000; max-width: 500px;';
            errorDiv.innerHTML = `<strong>Submission Failed</strong><br>${errorMessage}`;
            document.body.appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function updateAllText() {
            // Progress steps
            const stepLabels = document.querySelectorAll('.step-label');
            stepLabels[0].textContent = t('stepDevice');
            stepLabels[1].textContent = t('stepRepair');
            stepLabels[2].textContent = t('stepQuote');
            if (stepLabels[3]) stepLabels[3].textContent = t('stepAppointment');

            // Update current view title
            const titleMap = { device: 'titleDevice', brand: 'titleBrand', model: 'titleModel' };
            const subtitleMap = { device: 'subtitleDevice', brand: 'subtitleBrand', model: 'subtitleModel' };
            document.querySelector('#step1 h1').textContent = t(titleMap[state.view]);
            document.querySelector('#step1 .subtitle').textContent = t(subtitleMap[state.view]);

            // Back navigation
            document.getElementById('backFromBrand').innerHTML = t('backToDevices');
            document.getElementById('backFromModel').innerHTML = t('backToBrands');

            // Step 2
            document.querySelector('#step2 h1').textContent = t('titleRepair');
            document.querySelector('#step2 .subtitle').textContent = t('subtitleRepair');

            // Step 3
            document.querySelector('#step3 h1').textContent = t('titleQuote');
            document.querySelector('#step3 .subtitle').textContent = t('subtitleQuote');
            document.querySelector('.summary-title').textContent = t('summaryTitle');
            const summaryLabels = document.querySelectorAll('.summary-label');
            summaryLabels[0].textContent = t('summaryDevice');
            summaryLabels[1].textContent = t('summaryModel');
            summaryLabels[2].textContent = t('summaryRepairs');

            // Service types
            document.querySelector('#shopOption .service-title').textContent = t('serviceShopTitle');
            document.querySelector('#shopOption .service-description').textContent = t('serviceShopDesc');
            document.querySelector('#postOption .service-title').textContent = t('servicePostTitle');
            document.querySelector('#postOption .service-description').textContent = t('servicePostDesc');
            document.querySelectorAll('.service-badge').forEach(b => b.textContent = t('serviceBadge'));

            // Step 4
            document.querySelector('#step4 h1').textContent = t('titleAppointment');
            document.querySelector('#step4 .subtitle').textContent = t('subtitleAppointment');

            // Form labels
            document.querySelector('label[for="firstName"]').textContent = t('labelFirstName') + ' *';
            document.querySelector('label[for="lastName"]').textContent = t('labelLastName') + ' *';
            document.querySelector('label[for="email"]').textContent = t('labelEmail') + ' *';
            document.querySelector('label[for="phone"]').textContent = t('labelPhone') + ' *';
            document.querySelector('label[for="street"]').textContent = t('labelStreet') + ' *';
            document.querySelector('label[for="houseNumber"]').textContent = t('labelHouseNumber') + ' *';
            document.querySelector('label[for="postalCode"]').textContent = t('labelPostalCode') + ' *';
            document.querySelector('label[for="city"]').textContent = t('labelCity') + ' *';
            document.querySelector('label[for="imei"]').textContent = t('labelImei');
            document.querySelector('label[for="notes"]').textContent = t('labelNotes');

            // Placeholders
            document.getElementById('firstName').placeholder = t('placeholderFirstName');
            document.getElementById('lastName').placeholder = t('placeholderLastName');
            document.getElementById('email').placeholder = t('placeholderEmail');
            document.getElementById('phone').placeholder = t('placeholderPhone');
            document.getElementById('street').placeholder = t('placeholderStreet');
            document.getElementById('houseNumber').placeholder = t('placeholderHouseNumber');
            document.getElementById('postalCode').placeholder = t('placeholderPostalCode');
            document.getElementById('city').placeholder = t('placeholderCity');
            document.getElementById('imei').placeholder = t('placeholderImei');
            document.getElementById('notes').placeholder = t('placeholderNotes');

            // Buttons
            document.getElementById('nextToRepair').textContent = t('btnContinue');
            document.getElementById('backToDevice').textContent = t('btnBack');
            document.getElementById('nextToQuote').textContent = t('btnContinue');
            document.getElementById('backToRepair').textContent = t('btnBack');
            document.getElementById('continueFromQuote').textContent = state.serviceType === 'post' ? t('btnSubmit') : t('btnContinue');
            document.getElementById('backToQuote').textContent = t('btnBack');
            document.getElementById('submitAppointment').textContent = t('btnConfirmAppointment');

            // Success
            document.querySelector('.success-title').textContent = t('successTitle');
            document.querySelector('.success-text').textContent = t('successText');
            document.querySelector('#success button').textContent = t('btnBackHome');

            // Re-render dynamic content
            renderDevices();
            if (state.view === 'brand') renderBrands();
            if (state.view === 'model' && state.brand) renderModels(state.brand);
            renderRepairs();
            if (state.repairs.length > 0) updateSelectedRepairsDisplay();
        }

        init();
    </script>
</body>
</html>
